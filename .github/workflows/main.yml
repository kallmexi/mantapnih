name: XY_RDP_1080P_HACKTOOLS_FIXED

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */8 * * *'

jobs:
  XY_PROJECT:
    runs-on: windows-latest
    timeout-minutes: 10080

    steps:
      - name: âœ… VALIDATE - Check Required Secrets
        run: |
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
          Write-Host "â•‘        VALIDASI SECRET & DEPENDENCY         â•‘" -ForegroundColor Cyan
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
          
          $errors = @()
          $warnings = @()
          
          $requiredSecrets = @{
            "TAILSCALE_AUTH_KEY" = "${{ secrets.TAILSCALE_AUTH_KEY }}"
            "XY_RDP_PASSWORD" = "${{ secrets.XY_RDP_PASSWORD }}"
          }
          
          foreach ($secret in $requiredSecrets.Keys) {
            if ([string]::IsNullOrEmpty($requiredSecrets[$secret])) {
              if ($secret -eq "XY_RDP_PASSWORD") {
                $warnings += "âš ï¸ $secret kosong - akan pake default password"
              } else {
                $errors += "âŒ $secret wajib diisi! Gak bisa lanjut."
              }
            } else {
              Write-Host "âœ… $secret [OK]" -ForegroundColor Green
            }
          }
          
          $optionalSecrets = @{
            "DISCORD_WEBHOOK" = "${{ secrets.DISCORD_WEBHOOK }}"
            "TELEGRAM_BOT_TOKEN" = "${{ secrets.TELEGRAM_BOT_TOKEN }}"
            "TELEGRAM_CHAT_ID" = "${{ secrets.TELEGRAM_CHAT_ID }}"
            "NGROK_AUTH_TOKEN" = "${{ secrets.NGROK_AUTH_TOKEN }}"
          }
          
          foreach ($secret in $optionalSecrets.Keys) {
            if ([string]::IsNullOrEmpty($optionalSecrets[$secret])) {
              Write-Host "âš ï¸ $secret [KOSONG - fitur related gak jalan]" -ForegroundColor Yellow
            } else {
              Write-Host "âœ… $secret [OK]" -ForegroundColor Green
            }
          }
          
          if ($errors.Count -gt 0) {
            Write-Host "`nâŒ FATAL ERROR - Secret wajib kurang:" -ForegroundColor Red
            foreach ($err in $errors) { Write-Host $err -ForegroundColor Red }
            exit 1
          }
          
          if ($warnings.Count -gt 0) {
            Write-Host "`nâš ï¸ WARNINGS:" -ForegroundColor Yellow
            foreach ($warn in $warnings) { Write-Host $warn -ForegroundColor Yellow }
          }
          
          Write-Host "`nâœ… VALIDASI BERHASIL - Lanjut eksekusi..." -ForegroundColor Green

      - name: âš¡ OPTIMIZE - Set 1080p Resolution & Performance
        run: |
          Write-Host ">>> Optimasi sistem buat 1080p & performa gila..." -ForegroundColor Magenta
          
          $registryOptimizations = @(
            @{Path="HKLM:\SYSTEM\CurrentControlSet\Control\PriorityControl"; Name="Win32PrioritySeparation"; Value=38; Type="DWord"},
            @{Path="HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile"; Name="SystemResponsiveness"; Value=10; Type="DWord"},
            @{Path="HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile"; Name="NetworkThrottlingIndex"; Value=4294967295; Type="DWord"}
          )
          
          foreach ($reg in $registryOptimizations) {
            try {
              if (-not (Test-Path $reg.Path)) {
                New-Item -Path $reg.Path -Force | Out-Null
              }
              Set-ItemProperty -Path $reg.Path -Name $reg.Name -Value $reg.Value -Type $reg.Type -Force
              Write-Host "  âœ… Registry: $($reg.Name) = $($reg.Value)" -ForegroundColor Green
            } catch {
              Write-Host "  âš ï¸ Gagal set registry $($reg.Name): $_" -ForegroundColor Yellow
            }
          }
          
          $rdpResolution = @(
            @{Path="HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp"; Name="MaxXResolution"; Value=1920; Type="DWord"},
            @{Path="HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp"; Name="MaxYResolution"; Value=1080; Type="DWord"},
            @{Path="HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp"; Name="ColorDepth"; Value=32; Type="DWord"}
          )
          
          foreach ($rdp in $rdpResolution) {
            try {
              Set-ItemProperty -Path $rdp.Path -Name $rdp.Name -Value $rdp.Value -Type $rdp.Type -Force
            } catch {}
          }
          
          powercfg /setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c
          Write-Host "âœ… Optimasi 1080p & performa selesai!" -ForegroundColor Green

      - name: ğŸ‘¤ USER - Create 1080p Admin User
        run: |
          Write-Host ">>> Bikin user admin buat RDP 1080p..." -ForegroundColor Cyan
          
          $password = "${{ secrets.XY_RDP_PASSWORD }}"
          if ([string]::IsNullOrEmpty($password)) {
            $password = "H4ck3rVIP@1080p"
            Write-Host "âš ï¸ Pake default password: H4ck3rVIP@1080p" -ForegroundColor Yellow
          }
          
          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          
          $oldUsers = @("XY_VIP", "XY_ADMIN", "HACKER", "ADMIN_VIP", "H4CK3R_VIP")
          foreach ($oldUser in $oldUsers) {
            $userExists = Get-LocalUser -Name $oldUser -ErrorAction SilentlyContinue
            if ($userExists) {
              Remove-LocalUser -Name $oldUser -Force -ErrorAction SilentlyContinue
              Write-Host "  ğŸ—‘ï¸ Hapus user lama: $oldUser" -ForegroundColor Yellow
            }
          }
          
          try {
            New-LocalUser -Name "H4CK3R_VIP" -Password $securePass -FullName "1080p Hacker" -Description "DARK AI HACKING SYSTEM" -AccountNeverExpires -ErrorAction Stop
            Write-Host "âœ… User H4CK3R_VIP berhasil dibuat" -ForegroundColor Green
          } catch {
            Write-Host "âŒ Gagal bikin user: $_" -ForegroundColor Red
            net user H4CK3R_VIP $password /add /fullname:"1080p Hacker" /comment:"DARK AI HACKING SYSTEM" /expires:never
          }
          
          try {
            Add-LocalGroupMember -Group "Administrators" -Member "H4CK3R_VIP" -ErrorAction Stop
            Add-LocalGroupMember -Group "Remote Desktop Users" -Member "H4CK3R_VIP" -ErrorAction Stop
          } catch {
            net localgroup Administrators H4CK3R_VIP /add
            net localgroup "Remote Desktop Users" H4CK3R_VIP /add
          }
          
          New-Item -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList" -Force | Out-Null
          New-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList" -Name "H4CK3R_VIP" -Value 0 -PropertyType DWord -Force
          
          $credFile = @{
            Username = "H4CK3R_VIP"
            Password = $password
            Resolution = "1920x1080"
          } | ConvertTo-Json
          
          $credFile | Out-File -FilePath "C:\credentials.json" -Encoding UTF8
          
          Write-Host "âœ… User H4CK3R_VIP siap tempur dengan resolusi 1080p!" -ForegroundColor Green

      - name: ğŸ› ï¸ HACKTOOLS - Install Hacking Tools
        run: |
          Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Red
          Write-Host "â•‘        INSTALL HACKING TOOLS LENGKAP        â•‘" -ForegroundColor Red
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Red
          
          if (-not (Get-Command choco -ErrorAction SilentlyContinue)) {
            Write-Host ">>> Install Chocolatey..." -ForegroundColor Yellow
            Set-ExecutionPolicy Bypass -Scope Process -Force
            [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
            iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
            refreshenv
          }
          
          $tools = @(
            "nmap", "wireshark", "putty", "advanced-ip-scanner",
            "john-the-ripper", "hashcat", "hydra",
            "burp-suite-free-edition", "owasp-zap", "nikto", "dirb", "sqlmap",
            "aircrack-ng", "metasploit",
            "python", "git", "curl", "wget", "openssh", "vscode"
          )
          
          foreach ($tool in $tools) {
            Write-Host ">>> Install $tool..." -ForegroundColor Cyan
            try {
              choco install $tool -y --limit-output --no-progress --ignore-checksums --force
              Write-Host "  âœ… $tool berhasil" -ForegroundColor Green
            } catch {
              Write-Host "  âš ï¸ $tool gagal: $_" -ForegroundColor Yellow
            }
          }
          
          New-Item -Path "C:\Tools" -ItemType Directory -Force | Out-Null
          
          Write-Host "`nâœ… SEMUA HACK TOOLS BERHASIL DIINSTALL!" -ForegroundColor Green

      - name: ğŸ”Œ REMOTE - Setup Tailscale & Ngrok
        run: |
          Write-Host ">>> Setup remote access methods..." -ForegroundColor Cyan
          
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
          netsh advfirewall firewall add rule name="RDP-1080p" dir=in action=allow protocol=TCP localport=3389
          
          Write-Host ">>> Install Tailscale..." -ForegroundColor Cyan
          try {
            $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"
            $tsPath = "$env:TEMP\tailscale.msi"
            Invoke-WebRequest -Uri $tsUrl -OutFile $tsPath -UseBasicParsing
            Start-Process msiexec.exe -ArgumentList "/i", "`"$tsPath`"", "/quiet", "/norestart" -Wait
            
            $authKey = "${{ secrets.TAILSCALE_AUTH_KEY }}"
            if ($authKey) {
              & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=$authKey --hostname=1080p-HACK-${{ github.run_id }}
              Start-Sleep -Seconds 10
              $tsIP = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4
              Write-Host "  âœ… Tailscale IP: $tsIP" -ForegroundColor Green
            } else {
              $tsIP = "TAILSCALE KEY GAK ADA"
              Write-Host "  âš ï¸ Tailscale key kosong" -ForegroundColor Yellow
            }
          } catch {
            $tsIP = "TAILSCALE GAGAL INSTALL"
            Write-Host "  âš ï¸ Tailscale gagal: $_" -ForegroundColor Yellow
          }
          
          echo "TAILSCALE_IP=$tsIP" >> $env:GITHUB_ENV

      - name: ğŸ“Š INFO - Grab System Information
        run: |
          Write-Host ">>> Mengambil informasi sistem..." -ForegroundColor Cyan
          
          $sysInfo = @{}
          $sysInfo["Hostname"] = $env:COMPUTERNAME
          $sysInfo["Public_IP"] = (Invoke-WebRequest -Uri "https://api.ipify.org" -UseBasicParsing).Content
          $sysInfo["Tailscale_IP"] = $env:TAILSCALE_IP
          
          $creds = Get-Content "C:\credentials.json" | ConvertFrom-Json
          $sysInfo["Username"] = $creds.Username
          $sysInfo["Password"] = $creds.Password
          $sysInfo["Resolution"] = $creds.Resolution
          
          $sysInfo | ConvertTo-Json | Out-File -FilePath "C:\system_info.json" -Encoding UTF8
          
          Write-Host "`nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
          Write-Host "â•‘       1080p HACKING SYSTEM READY           â•‘" -ForegroundColor Cyan
          Write-Host "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£" -ForegroundColor Cyan
          Write-Host "â•‘ Hostname    : $($sysInfo.Hostname)" -ForegroundColor White
          Write-Host "â•‘ Public IP   : $($sysInfo.Public_IP)" -ForegroundColor Green
          Write-Host "â•‘ Tailscale IP: $($sysInfo.Tailscale_IP)" -ForegroundColor Green
          Write-Host "â•‘ Username    : $($sysInfo.Username)" -ForegroundColor Yellow
          Write-Host "â•‘ Password    : $($sysInfo.Password)" -ForegroundColor Yellow
          Write-Host "â•‘ Resolution  : $($sysInfo.Resolution)" -ForegroundColor Magenta
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan

      - name: ğŸ“± NOTIFY - Send to Discord & Telegram
        run: |
          Write-Host ">>> Mengirim notifikasi..." -ForegroundColor Cyan
          
          $sysInfo = Get-Content "C:\system_info.json" | ConvertFrom-Json
          
          $message = @"
ğŸ”¥ **1080p HACKING SYSTEM AKTIF!** ğŸ”¥

**SERVER INFO:**
- Hostname: $($sysInfo.Hostname)
- Public IP: $($sysInfo.Public_IP)
- Tailscale IP: $($sysInfo.Tailscale_IP)
- Resolution: $($sysInfo.Resolution)

**ACCESS:**
- Username: $($sysInfo.Username)
- Password: $($sysInfo.Password)

**HOW TO CONNECT:**
RDP Langsung pake Tailscale IP di atas

â° Server akan jalan 7 hari non-stop!
"@
          
          $discordUrl = "${{ secrets.DISCORD_WEBHOOK }}"
          if ($discordUrl) {
            try {
              $body = @{ content = $message } | ConvertTo-Json
              Invoke-RestMethod -Uri $discordUrl -Method Post -Body $body -ContentType "application/json"
              Write-Host "  âœ… Discord notif terkirim" -ForegroundColor Green
            } catch {
              Write-Host "  âš ï¸ Discord gagal: $_" -ForegroundColor Yellow
            }
          }
          
          $telegramToken = "${{ secrets.TELEGRAM_BOT_TOKEN }}"
          $telegramChatId = "${{ secrets.TELEGRAM_CHAT_ID }}"
          if ($telegramToken -and $telegramChatId) {
            try {
              $telegramUrl = "https://api.telegram.org/bot$telegramToken/sendMessage"
              $body = @{
                chat_id = $telegramChatId
                text = $message
                parse_mode = "Markdown"
              }
              Invoke-RestMethod -Uri $telegramUrl -Method Post -Body $body
              Write-Host "  âœ… Telegram notif terkirim" -ForegroundColor Green
            } catch {
              Write-Host "  âš ï¸ Telegram gagal: $_" -ForegroundColor Yellow
            }
          }

      - name: â™¾ï¸ PERSIST - Keep Alive 7 Days
        run: |
          Write-Host "`nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Red
          Write-Host "â•‘    1080p HACKING SERVER - 7 DAYS MODE      â•‘" -ForegroundColor Red
          Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Red
          
          $endTime = (Get-Date).AddDays(7)
          
          while ((Get-Date) -lt $endTime) {
            $timeLeft = $endTime - (Get-Date)
            $daysLeft = [math]::Floor($timeLeft.TotalDays)
            $hoursLeft = [math]::Floor($timeLeft.TotalHours % 24)
            
            Write-Host "[$(Get-Date)] ğŸ”¥ 1080p HACK SERVER - Sisa: $daysLeft hari $hoursLeft jam" -ForegroundColor Green
            
            Start-Sleep -Seconds 300
          }
          
          Write-Host "[$(Get-Date)] â° WAKTU HABIS - Server mati..." -ForegroundColor Red
